<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Escape Room</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: { DEFAULT: "#2563eb", foreground: "#ffffff" },
                        secondary: { DEFAULT: "#f1f5f9", foreground: "#0f172a" },
                        destructive: { DEFAULT: "#ef4444", foreground: "#ffffff" },
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #ffffff; color: #0f172a; font-family: sans-serif; }
        /* Simple fallback for icons */
        svg { vertical-align: middle; }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen flex items-center justify-center bg-slate-50 text-slate-500">
        <div class="text-center">
            <h1 class="text-2xl font-bold mb-2">Loading Application...</h1>
            <p class="text-sm">Please ensure you have an internet connection to load the libraries.</p>
        </div>
    </div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('root').innerHTML = `
                <div style="color: red; padding: 20px; text-align: center;">
                    <h2 style="font-size: 24px; font-weight: bold;">Something went wrong</h2>
                    <p style="margin-top: 10px;">${message}</p>
                    <p style="font-size: 12px; margin-top: 10px; color: #666;">Line: ${lineno}</p>
                </div>
            `;
        };
    </script>

    <script type="text/babel" data-presets="env,react">
        const { useState, useEffect, createContext, useContext } = React;

        // --- UI COMPONENTS ---
        
        const Button = ({ children, className = "", variant = "default", size = "default", disabled, onClick, type="button" }) => {
            let bgClass = "bg-blue-600 text-white hover:bg-blue-700";
            if (variant === "outline") bgClass = "border border-slate-300 bg-white text-slate-700 hover:bg-slate-50";
            if (variant === "ghost") bgClass = "bg-transparent text-slate-700 hover:bg-slate-100";
            if (variant === "destructive") bgClass = "bg-red-600 text-white hover:bg-red-700";
            
            const sizeClass = size === "sm" ? "px-3 py-1 text-sm" : "px-4 py-2";
            const opacity = disabled ? "opacity-50 cursor-not-allowed" : "";

            return (
                <button 
                    type={type}
                    onClick={onClick}
                    disabled={disabled}
                    className={`inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 ${bgClass} ${sizeClass} ${opacity} ${className}`}
                >
                    {children}
                </button>
            );
        };

        const Card = ({ className = "", children }) => (
            <div className={`rounded-xl border border-slate-200 bg-white text-slate-950 shadow-sm ${className}`}>
                {children}
            </div>
        );

        const Input = ({ className = "", ...props }) => (
            <input className={`flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 ${className}`} {...props} />
        );

        const Label = ({ className = "", children, ...props }) => (
            <label className={`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${className}`} {...props}>
                {children}
            </label>
        );

        // --- ICONS ---
        const Icon = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const Icons = {
            Mail: (p) => <Icon {...p} d={<><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></>} />,
            Lock: (p) => <Icon {...p} d={<><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></>} />,
            Unlock: (p) => <Icon {...p} d={<><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></>} />,
            Timer: (p) => <Icon {...p} d={<><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></>} />,
            AlertTriangle: (p) => <Icon {...p} d={<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>} />,
// --- FIXED SECTION BELOW ---
            Trophy: (p) => <Icon {...p} d={<>
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                <path d="M4 22h16"/>
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
            </>} />,
            
            Wifi: (p) => <Icon {...p} d={<>
                <path d="M5 12.55a11 11 0 0 1 14.08 0"/>
                <path d="M1.42 9a16 16 0 0 1 21.16 0"/>
                <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/>
                <line x1="12" y1="20" x2="12.01" y2="20"/>
            </>} />,
            
            Loader2: (p) => <Icon {...p} d={<path d="M21 12a9 9 0 1 1-6.219-8.56"/>} />,
            
            RotateCcw: (p) => <Icon {...p} d={<>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </>} />
        };

        // --- DATA & CONSTANTS ---
        const translations = {
            fi: {
                title: "Pakohuone — Sähköposti & Kirjautumissimulaatio",
                subtitle: "Turvallinen paikallinen simulaatio. Ei tietoja lähetetä.",
                tabEmails: "Sähköpostit",
                tabLogin: "Kirjaudu",
                inboxTitle: "Saapuneet",
                quickLoginTitle: "Nopea simulaatiokirjautuminen",
                quickLoginNote: "Tämä on vain simulaatio — tunnukset näkyvät alla.",
                openLoginBtn: "Avaa kirjautuminen",
                simCredsTitle: "SIMULAATIO TUNNUKSET",
                trainerTips: "Ohjaajan huomautus: pidä nämä tunnukset näkyvissä.",
                trainerTitle: "Ohjaajan vinkit",
                tip1: "Muokkaa sähköpostiviestien sisältöä komponentissa.",
                tip2: "Älä yhdistä tätä sivua oikeisiin kirjautumisiin.",
                tip3: "Ratkaisun voi paljastaa kirjautumisen jälkeen.",
                loginTitle: "Kirjaudu",
                usernameLabel: "Käyttäjätunnus",
                passwordLabel: "Salasana",
                usernamePlaceholder: "Anna käyttäjätunnus",
                passwordPlaceholder: "Anna salasana",
                signInBtn: "Kirjaudu",
                loginNotice: "Tämä sivu simuloi kirjautumista paikallisesti.",
                successTitle: "Onnistui — pääsy myönnetty",
                successText: "Olet kirjautunut simulaatiotunnuksilla.",
                secretMessage: "Kunnes sairaalan järjestelmä poistaa kaiken potilasdatan turvallisuussyistä viimeisen vuoden ajalta!",
                footerNote: "Tietosuoja & turvallisuus: Tämä on paikallinen harjoitustyökalu.",
                loginError: "Virheellinen käyttäjätunnus tai salasana",
                timeUp: "Aika loppui!",
                dataErased: "Kaikki data poistettu",
                youLose: "Hävisit.",
                keywordPlaceholder: "Ratkaise koodi...",
                keywordLabel: "Vahvistuskoodi",
                wifiTitle: "Verkkoyhteys vaaditaan",
                wifiDesc: "Valitse verkko muodostaaksesi yhteys palvelimiin.",
                wifiPublic: "Sairaala_Vieras_Julkinen",
                wifiSecure: "Sairaala_Suojattu_Intranet",
                wifiConnectBtn: "Yhdistä",
                wifiStatusPublic: "Yhteysvirhe",
                wifiErrorPublic: "Sisäinen Intranet ei ole käytettävissä julkisessa verkossa.",
                wifiPenalty: "3 minuuttia vähennetty ajastimesta.",
                wifiStatusSecure: "Yhdistetty suojattuun verkkoon",
                connecting: "Yhdistetään...",
                submit: "Lähetä",
                enterAnswer: "Syötä vastaus pysäyttääksesi ajastimen:",
                answerPlaceholder: "Kirjoita vastaus...",
                incorrect: "Väärä vastaus!",
                restart: "Aloita alusta"
            },
            en: {
                title: "Escape Room — Email & Login Simulation",
                subtitle: "Safe local simulation. No data is sent anywhere.",
                tabEmails: "Emails",
                tabLogin: "Login",
                inboxTitle: "Inbox",
                quickLoginTitle: "Quick simulation login",
                quickLoginNote: "This is a simulation only — credentials visible below.",
                openLoginBtn: "Open Login",
                simCredsTitle: "SIMULATION CREDENTIALS",
                trainerTips: "Trainer note: keep these credentials visible.",
                trainerTitle: "Trainer tips",
                tip1: "Edit the email content in the component.",
                tip2: "Do not connect this page to real auth systems.",
                tip3: "You can reveal the solution after login.",
                loginTitle: "Login",
                usernameLabel: "Username",
                passwordLabel: "Password",
                usernamePlaceholder: "Enter username",
                passwordPlaceholder: "Enter password",
                signInBtn: "Sign in",
                loginNotice: "This page simulates login locally.",
                successTitle: "Success — access granted",
                successText: "You are logged in with simulation credentials.",
                secretMessage: "Until the hospital system wipes down all the patient data for the last year for safety reasons!",
                footerNote: "Privacy & safety: This is a local training tool.",
                loginError: "Incorrect username or password",
                timeUp: "Time's up!",
                dataErased: "All data erased",
                youLose: "You lose.",
                keywordPlaceholder: "Solve code...",
                keywordLabel: "Verification Code",
                wifiTitle: "Network Connection Required",
                wifiDesc: "Select a network to connect to servers.",
                wifiPublic: "Hospital_Guest_Public",
                wifiSecure: "Hospital_Secure_Intranet",
                wifiConnectBtn: "Connect",
                wifiStatusPublic: "Connection Error",
                wifiErrorPublic: "Internal Intranet not accessible on Public Network.",
                wifiPenalty: "3 minutes deducted from timer.",
                wifiStatusSecure: "Connected to Secure Network",
                connecting: "Connecting...",
                submit: "Submit",
                enterAnswer: "Enter answer to stop the timer:",
                answerPlaceholder: "Type answer...",
                incorrect: "Incorrect answer!",
                restart: "Try Again"
            },
        };

        const emails = {
            fi: [
                {
                    from: "admin@varha.fi",
                    to: "sairaala@kybersote.fi",
                    date: "1.10.2025",
                    subject: "(tyhjä)",
                    body: "111 0011 , 110 0001 , 110 0001 , 111 0000 , 110 001 , 111 0011",
                    keyword: "saapas",
                },
                {
                    from: "asiakaspalvelu@op.fi",
                    to: "sairaala@kybersote.fi",
                    date: "3.10.2025",
                    subject: "Pankkisiirrot",
                    body: "111 0000 , 110 0101 , 110 1100 , 110 0001 , 111 0011 , 111 0100 , 110 0001",
                    keyword: "laskut",
                },
                {
                    from: "it@kybersote.fi",
                    to: "sairaala@kybersote.fi",
                    date: "5.10.2025",
                    subject: "Salatut potilastiedot",
                    body: "tbmbtbobbo ubswjutfu tbobo qpujmbbu",
                    keyword: "potilaat",
                },
            ],
            en: [
                {
                    from: "admin@varha.fi",
                    to: "hospital@cybersote.fi",
                    date: "Oct 1, 2025",
                    subject: "(empty)",
                    body: "111 0011 , 110 0001 , 110 0001 , 111 0000 , 110 001 , 111 0011",
                    keyword: "start",
                },
                {
                    from: "service@op.fi",
                    to: "hospital@cybersote.fi",
                    date: "Oct 3, 2025",
                    subject: "Bank Transfers",
                    body: "111 0000 , 110 0101 , 110 1100 , 110 0001 , 111 0011 , 111 0100 , 110 0001",
                    keyword: "middle",
                },
                {
                    from: "it@cybersote.fi",
                    to: "hospital@cybersote.fi",
                    date: "Oct 5, 2025",
                    subject: "Encrypted Data",
                    body: "tbmbtbobbo ubswjutfu tbobo qpujmbbu",
                    keyword: "end",
                },
            ],
        };

        const SIM_USERNAME = "simuser";
        const SIM_PASSWORD = "simpass";
        const CORRECT_ANSWER_FI = "Saapas laskut potilaat";
        const CORRECT_ANSWER_EN = "start middle end";

        // --- MAIN APP ---
        const EscapeRoom = () => {
            const [lang, setLang] = useState("fi");
            const [username, setUsername] = useState("");
            const [password, setPassword] = useState("");
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [loginError, setLoginError] = useState("");
            const [timeLeft, setTimeLeft] = useState(30 * 60);
            const [timerActive, setTimerActive] = useState(false);
            const [gameOver, setGameOver] = useState(false);
            const [activeTab, setActiveTab] = useState("emails");
            const [checkedEmails, setCheckedEmails] = useState([false, false, false]);
            const [emailInputs, setEmailInputs] = useState(["", "", ""]);
            const [answerInput, setAnswerInput] = useState("");
            const [answerError, setAnswerError] = useState(false);
            const [isWinner, setIsWinner] = useState(false);

            // WiFi State
            const [wifiStatus, setWifiStatus] = useState("disconnected");
            const [selectedWifi, setSelectedWifi] = useState(null);

            const t = translations[lang];
            const emailList = emails[lang];

            // Timer Logic
            useEffect(() => {
                if (!timerActive) return;
                const interval = setInterval(() => {
                    setTimeLeft((prev) => {
                        if (prev <= 1) {
                            setGameOver(true);
                            setTimerActive(false);
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
                return () => clearInterval(interval);
            }, [timerActive]);

            const handleConnectWifi = () => {
                if (!selectedWifi) return;
                setWifiStatus("connecting");
                setTimeout(() => {
                    if (selectedWifi === "public") {
                        setWifiStatus("public");
                        setTimeLeft(prev => Math.max(0, prev - 180)); // Penalty
                    } else {
                        setWifiStatus("secure");
                    }
                }, 1500);
            };

            const handleLogin = (e) => {
                e.preventDefault();
                if (username === SIM_USERNAME && password === SIM_PASSWORD) {
                    setIsLoggedIn(true);
                    setLoginError("");
                    setTimerActive(true);
                } else {
                    setLoginError(t.loginError);
                    setIsLoggedIn(false);
                }
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, "0")}`;
            };

            const checkKeywordMatch = (index) => {
                return emailInputs[index].trim().toLowerCase() === emailList[index].keyword.toLowerCase();
            };

            const handleCheckEmail = (index) => {
                if (!checkKeywordMatch(index)) return;
                const newChecked = [...checkedEmails];
                newChecked[index] = !newChecked[index];
                setCheckedEmails(newChecked);
            };

            const handleAnswerSubmit = (e) => {
                e.preventDefault();
                const cleanInput = answerInput.toLowerCase().trim().replace(/\s+/g, ' ');
                if (cleanInput === CORRECT_ANSWER_FI.toLowerCase() || cleanInput === CORRECT_ANSWER_EN.toLowerCase()) {
                    setIsWinner(true);
                    setTimerActive(false);
                } else {
                    setAnswerError(true);
                    setTimeout(() => setAnswerError(false), 3000);
                }
            };

            const handleRestart = () => {
                setGameOver(false);
                setIsWinner(false);
                setTimerActive(false);
                setIsLoggedIn(false);
                setWifiStatus("disconnected");
                setSelectedWifi(null);
                setTimeLeft(30 * 60);
                setUsername("");
                setPassword("");
                setAnswerInput("");
                setEmailInputs(["", "", ""]);
                setCheckedEmails([false, false, false]);
            };

            // --- RENDER: WIN SCREEN ---
            if (isWinner) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-green-50 text-slate-900 p-4 animate-fade-in">
                        <div className="text-center space-y-6">
                            <div className="inline-block p-4 rounded-full bg-green-100 mb-4">
                                <Icons.Trophy className="w-20 h-20 text-green-600" />
                            </div>
                            <h1 className="text-5xl font-bold text-green-700">{lang === "fi" ? "Voitit!" : "You Win!"}</h1>
                            <Button onClick={handleRestart} size="lg" variant="outline" className="mt-8">
                                <Icons.RotateCcw className="w-4 h-4 mr-2" /> {t.restart}
                            </Button>
                        </div>
                    </div>
                );
            }

            // --- RENDER: GAME OVER ---
            if (gameOver) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-slate-900 text-red-500 p-4">
                        <div className="text-center space-y-6">
                            <Icons.AlertTriangle className="w-20 h-20 mx-auto animate-pulse" />
                            <h1 className="text-5xl font-bold">{t.dataErased}</h1>
                            <p className="text-2xl">{t.youLose}</p>
                            <Button onClick={handleRestart} size="lg" className="mt-8 bg-slate-800 text-white border border-slate-700 hover:bg-slate-700">
                                <Icons.RotateCcw className="w-4 h-4 mr-2" /> {t.restart}
                            </Button>
                        </div>
                    </div>
                );
            }

            // --- RENDER: MAIN UI ---
            return (
                <div className="min-h-screen bg-white text-slate-900 p-4 md:p-8 font-sans max-w-6xl mx-auto">
                    
                    {/* Header */}
                    <header className="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-8">
                        <div>
                            <h1 className="text-2xl md:text-3xl font-bold text-blue-600">{t.title}</h1>
                            <p className="text-slate-500 text-sm mt-1">{t.subtitle}</p>
                        </div>
                        <div className="flex flex-col items-end gap-2">
                            <div className="flex gap-2">
                                <Button variant={lang === "fi" ? "default" : "outline"} size="sm" onClick={() => setLang("fi")}>Suomi</Button>
                                <Button variant={lang === "en" ? "default" : "outline"} size="sm" onClick={() => setLang("en")}>English</Button>
                            </div>
                        </div>
                    </header>

                    {/* WIFI SCREEN */}
                    {wifiStatus !== "secure" && (
                        <div className="flex justify-center items-center min-h-[50vh]">
                            <Card className="w-full max-w-md p-6 space-y-6 shadow-xl">
                                <div className="text-center">
                                    <div className="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <Icons.Wifi className="w-6 h-6 text-blue-600" />
                                    </div>
                                    <h2 className="text-xl font-bold text-blue-900">{t.wifiTitle}</h2>
                                    <p className="text-slate-500 text-sm">{t.wifiDesc}</p>
                                </div>

                                <div className="space-y-3">
                                    <div onClick={() => wifiStatus !== 'connecting' && setSelectedWifi("public")}
                                        className={`flex items-center justify-between p-4 rounded-lg border cursor-pointer transition-all ${selectedWifi === "public" ? "border-blue-600 bg-blue-50 ring-1 ring-blue-600" : "border-slate-200 hover:border-blue-300"}`}>
                                        <div className="flex items-center gap-3">
                                            <Icons.Wifi className="w-5 h-5 text-yellow-500" />
                                            <div><span className="font-bold text-sm block">{t.wifiPublic}</span><span className="text-xs text-slate-500">Open / Unsecured</span></div>
                                        </div>
                                        {selectedWifi === "public" && <div className="w-3 h-3 bg-blue-600 rounded-full" />}
                                    </div>

                                    <div onClick={() => wifiStatus !== 'connecting' && setSelectedWifi("secure")}
                                        className={`flex items-center justify-between p-4 rounded-lg border cursor-pointer transition-all ${selectedWifi === "secure" ? "border-blue-600 bg-blue-50 ring-1 ring-blue-600" : "border-slate-200 hover:border-blue-300"}`}>
                                        <div className="flex items-center gap-3">
                                            <Icons.Lock className="w-5 h-5 text-green-500" />
                                            <div><span className="font-bold text-sm block">{t.wifiSecure}</span><span className="text-xs text-slate-500">WPA2 Enterprise</span></div>
                                        </div>
                                        {selectedWifi === "secure" && <div className="w-3 h-3 bg-blue-600 rounded-full" />}
                                    </div>
                                </div>

                                {wifiStatus === "public" && (
                                    <div className="p-3 bg-red-50 border border-red-100 text-red-600 rounded text-xs">
                                        <p className="font-bold">{t.wifiStatusPublic}</p>
                                        <p>{t.wifiErrorPublic}</p>
                                        <p className="mt-1 pt-1 border-t border-red-200">{t.wifiPenalty}</p>
                                    </div>
                                )}

                                <Button onClick={handleConnectWifi} disabled={!selectedWifi || wifiStatus === "connecting"} className="w-full" size="lg">
                                    {wifiStatus === "connecting" ? <span className="flex items-center"><Icons.Loader2 className="w-4 h-4 mr-2 animate-spin"/> {t.connecting}</span> : t.wifiConnectBtn}
                                </Button>
                            </Card>
                        </div>
                    )}

                    {/* MAIN SECURE CONTENT */}
                    {wifiStatus === "secure" && (
                        <div className="space-y-6 animate-fade-in">
                            {/* Status Bar */}
                            <div className="flex items-center gap-2 p-2 px-4 bg-green-50 border border-green-200 rounded-full w-fit text-xs text-green-700 font-mono">
                                <Icons.Wifi className="w-3 h-3" /> {t.wifiStatusSecure}
                            </div>

                            {/* Timer */}
                            <Card className="p-6 border-2 border-red-100 bg-red-50/30">
                                <div className="flex flex-col items-center text-center gap-2 mb-4">
                                    <Icons.Timer className="w-8 h-8 text-red-500 animate-pulse" />
                                    <div className="text-5xl font-mono font-bold text-red-600">{formatTime(timeLeft)}</div>
                                    <p className="text-sm text-slate-500">{t.timeUp}</p>
                                </div>
                                {timerActive && (
                                    <form onSubmit={handleAnswerSubmit} className="max-w-md mx-auto flex gap-2">
                                        <Input value={answerInput} onChange={(e) => setAnswerInput(e.target.value)} placeholder={t.answerPlaceholder} />
                                        <Button type="submit">{t.submit}</Button>
                                    </form>
                                )}
                                {answerError && <p className="text-center text-red-500 text-sm font-bold mt-2 animate-pulse">{t.incorrect}</p>}
                            </Card>

                            {/* Navigation Tabs */}
                            <div className="flex gap-2 border-b border-slate-200 pb-1">
                                <button onClick={() => setActiveTab("emails")} className={`px-4 py-2 text-sm font-medium rounded-t-lg ${activeTab === "emails" ? "bg-blue-50 text-blue-600 border-b-2 border-blue-600" : "text-slate-500 hover:bg-slate-50"}`}>
                                    <span className="flex items-center"><Icons.Mail className="w-4 h-4 mr-2"/> {t.tabEmails}</span>
                                </button>
                                <button onClick={() => setActiveTab("login")} className={`px-4 py-2 text-sm font-medium rounded-t-lg ${activeTab === "login" ? "bg-blue-50 text-blue-600 border-b-2 border-blue-600" : "text-slate-500 hover:bg-slate-50"}`}>
                                    <span className="flex items-center"><Icons.Lock className="w-4 h-4 mr-2"/> {t.tabLogin}</span>
                                </button>
                            </div>

                            {/* EMAILS VIEW */}
                            {activeTab === "emails" && (
                                <div className="grid md:grid-cols-3 gap-6">
                                    <div className="md:col-span-2 space-y-4">
                                        {!isLoggedIn ? (
                                            <div className="p-12 text-center border-2 border-dashed border-slate-300 rounded-xl bg-slate-50">
                                                <Icons.Lock className="w-12 h-12 mx-auto text-slate-300 mb-2" />
                                                <p className="text-slate-500">{lang === "fi" ? "Kirjaudu sisään nähdäksesi viestit." : "Log in to view messages."}</p>
                                            </div>
                                        ) : (
                                            emailList.map((email, idx) => {
                                                const isUnlocked = checkKeywordMatch(idx);
                                                return (
                                                    <Card key={idx} className={`p-4 transition-all ${checkedEmails[idx] ? "border-green-500 ring-1 ring-green-500" : "hover:border-blue-300"}`}>
                                                        <div className="flex flex-col sm:flex-row gap-4">
                                                            {/* Validation Side */}
                                                            <div className="sm:w-48 bg-slate-50 p-3 rounded border border-slate-200 flex flex-col gap-2">
                                                                <Label className="text-xs text-slate-400">{t.keywordLabel}</Label>
                                                                <Input value={emailInputs[idx]} onChange={(e) => {
                                                                    const newInputs = [...emailInputs];
                                                                    newInputs[idx] = e.target.value;
                                                                    setEmailInputs(newInputs);
                                                                }} placeholder={t.keywordPlaceholder} className={`h-8 text-xs ${isUnlocked ? "bg-green-50 text-green-700 border-green-300" : ""}`} />
                                                                <div className="flex items-center gap-2 mt-1">
                                                                    <input type="checkbox" checked={checkedEmails[idx]} disabled={!isUnlocked} onChange={() => handleCheckEmail(idx)} className="rounded border-slate-300 text-green-600 focus:ring-green-500" />
                                                                    <span className={`text-xs ${isUnlocked ? "text-green-600 font-bold" : "text-slate-400"}`}>
                                                                        {isUnlocked ? (lang === 'fi' ? 'Avattu' : 'Unlocked') : (lang === 'fi' ? 'Lukittu' : 'Locked')}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            {/* Content Side */}
                                                            <div className="flex-1">
                                                                <div className="flex justify-between text-xs text-slate-400 mb-1">
                                                                    <span>{email.from}</span><span>{email.date}</span>
                                                                </div>
                                                                <h3 className="font-bold text-lg mb-2">{email.subject}</h3>
                                                                <div className="text-sm font-mono bg-slate-50 p-2 rounded border border-slate-100 break-words">{email.body}</div>
                                                            </div>
                                                        </div>
                                                    </Card>
                                                )
                                            })
                                        )}
                                    </div>

                                    {/* Sidebar Info */}
                                    <div className="space-y-4">
                                        <Card className="p-4 bg-yellow-50 border-yellow-200">
                                            <h3 className="font-bold text-yellow-700 mb-2">{t.quickLoginTitle}</h3>
                                            <p className="text-xs text-yellow-600 mb-3">{t.quickLoginNote}</p>
                                            <Button onClick={() => setActiveTab("login")} className="w-full bg-yellow-600 hover:bg-yellow-700 text-white">{t.openLoginBtn}</Button>
                                            <div className="mt-4 p-2 bg-white rounded border border-yellow-100 text-xs font-mono">
                                                <p className="font-bold text-slate-500 mb-1">{t.simCredsTitle}</p>
                                                <p>U: {SIM_USERNAME}</p>
                                                <p>P: {SIM_PASSWORD}</p>
                                            </div>
                                        </Card>
                                        <Card className="p-4 bg-blue-50 border-blue-100">
                                            <h3 className="font-bold text-blue-700 mb-2">{t.trainerTitle}</h3>
                                            <ul className="text-xs text-blue-600 list-disc list-inside space-y-1">
                                                <li>{t.tip1}</li><li>{t.tip2}</li><li>{t.tip3}</li>
                                            </ul>
                                        </Card>
                                    </div>
                                </div>
                            )}

                            {/* LOGIN VIEW */}
                            {activeTab === "login" && (
                                <div className="flex justify-center mt-8">
                                    <Card className="w-full max-w-md p-6 border-2 border-blue-100 shadow-xl">
                                        <h2 className="text-2xl font-bold text-blue-600 mb-6">{t.loginTitle}</h2>
                                        {!isLoggedIn ? (
                                            <form onSubmit={handleLogin} className="space-y-4">
                                                <div>
                                                    <Label>{t.usernameLabel}</Label>
                                                    <Input value={username} onChange={(e) => setUsername(e.target.value)} placeholder={t.usernamePlaceholder} required />
                                                </div>
                                                <div>
                                                    <Label>{t.passwordLabel}</Label>
                                                    <Input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder={t.passwordPlaceholder} required />
                                                </div>
                                                <Button type="submit" className="w-full">{t.signInBtn}</Button>
                                                {loginError && <p className="text-red-500 text-sm text-center">{loginError}</p>}
                                                <div className="text-center text-xs text-slate-400 mt-4 pt-4 border-t">{t.loginNotice}</div>
                                            </form>
                                        ) : (
                                            <div className="space-y-4 text-center">
                                                <div className="p-4 bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto">
                                                    <Icons.Unlock className="w-8 h-8 text-green-600" />
                                                </div>
                                                <h3 className="text-xl font-bold text-green-700">{t.successTitle}</h3>
                                                <div className="bg-slate-900 text-green-400 p-4 rounded-lg font-mono text-sm text-left">
                                                    {t.secretMessage}
                                                </div>
                                                <Button variant="outline" onClick={() => setActiveTab("emails")} className="w-full">{lang === 'fi' ? 'Takaisin sähköposteihin' : 'Back to Emails'}</Button>
                                            </div>
                                        )}
                                    </Card>
                                </div>
                            )}
                        </div>
                    )}
                    
                    <footer className="text-center text-xs text-slate-400 mt-12 pt-6 border-t border-slate-100">
                        {t.footerNote}
                    </footer>
                </div>
            );
        };

        // --- MOUNT ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EscapeRoom />);
    </script>
</body>
</html>